import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.GzzYzsTh.js";import{m as R,P}from"./papaparse.min.BXwBEW0e.js";/* empty css                     */const T="/atlas_hpe/";function H({indicator:p,map_data:h}){const v=g.useRef([null,null,null,null]),y=g.useRef([null,null,null,null]),_=g.useRef(null),C=g.useRef(null),c=g.useRef(null),j=g.useRef(null),b=g.useRef(!1);async function $(){const n=await fetch(`${T}data/mapas/mapa_${h}.geojson`);_.current=await n.json();const t=await(await fetch(`${T}data/v_g_e/v_g_e_${h}_65_80_2021_2023.csv`)).text();C.current=P.parse(t,{header:!0}).data.filter(r=>Object.keys(r).length>1);const a=await(await fetch(`${T}data/v_g_e/v_g_e_${h}_80_2021_2023.csv`)).text();c.current=P.parse(a,{header:!0}).data.filter(r=>Object.keys(r).length>1);const l=[...C.current,...c.current],o={};l.forEach(r=>{r.indicador&&r.color&&r.quintil&&(o[r.indicador]||(o[r.indicador]=[]),o[r.indicador].some(f=>f.color===r.color&&f.quintil===r.quintil)||o[r.indicador].push({color:r.color,quintil:r.quintil}))});const d={};Object.keys(o).forEach(r=>{d[r]=[...o[r]].sort((u,f)=>{const x=parseInt(u.quintil.match(/^Q(\d+)/)[1],10),m=parseInt(f.quintil.match(/^Q(\d+)/)[1],10);return x-m})}),j.current=d}g.useEffect(()=>{async function n(){await $();const s={style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[-6.7038,35.4168],zoom:4,attributionControl:!1};for(let t=0;t<4;t++){const e=new R.Map({container:v.current[t],attributionControl:{compact:!0},...s});e.addControl(new R.AttributionControl({compact:!0}),"bottom-left"),y.current[t]=e,e.on("load",()=>{const a=e.getContainer().querySelector(".maplibregl-ctrl-attrib-button"),l=e.getContainer().querySelector(".maplibregl-ctrl-attrib");a&&l&&(l.classList.add("maplibregl-compact"),l.classList.remove("maplibregl-compact-show"));const o=t<2?"te":"riest",d=`multipolygon-${t}`,r=`fill-${t}`;D(e,d,r,o),L(e,r,o,h);let u="";t===0?(u="Población 65 a 79 años",z(e,u)):t===1&&(u="Población mayores 80 años",z(e,u));const f=q(e,o);e._legendControl=f})}for(let t=0;t<4;t++)for(let e=0;e<4;e++)t!==e&&A(y.current[t],y.current[e])}return n(),()=>{y.current.forEach(s=>s?.remove())}},[h]),g.useEffect(()=>{!_.current||!C.current||!c.current||y.current.forEach((n,s)=>{if(!n)return;const t=s<2?"te":"riest",e=`multipolygon-${s}`;let a;s===0||s===2?a=E(t,p,"65_80"):a=E(t,p,"80"),n.getSource(e)&&n.getSource(e).setData(a),n._legendControl&&n._legendControl.update(a,p)})},[p]);function E(n,s,t){const e=structuredClone(_.current);let a="";t==="65_80"?a=C.current.filter(o=>o.indicador===s):a=c.current.filter(o=>o.indicador===s);const l={};return h==="area"?(a.forEach(o=>{l[o.idn212]=o}),e.features.forEach(o=>{const d=l[o.properties.IDN];d&&(o.properties={...o.properties,...d})})):(a.forEach(o=>{l[o.zbs]=o}),e.features.forEach(o=>{const d=l[o.properties.codatzbs];d&&(o.properties={...o.properties,...d})})),e}function D(n,s,t,e){let a;t==="fill-0"||t==="fill-2"?a=E(e,p,"65_80"):a=E(e,p,"80"),n.getSource(s)?n.getSource(s).setData(a):(n.addSource(s,{type:"geojson",data:a}),n.addLayer({id:t,type:"fill",source:s,paint:{"fill-color":["coalesce",e==="te"?["get","color"]:["get","significativamente_sup_uno"],"transparent"],"fill-opacity":.8}}),n.addLayer({id:`${t}-outline`,type:"line",source:s,paint:{"line-color":"#333","line-width":.5}}))}function L(n,s,t,e){n.on("click",s,a=>{const l=a.features?.[0];if(!l)return;const o=e==="zbs"?l.properties.n_zbs:l.properties.n_area,{te:d,riest:r,significativamente_sup_uno:u}=l.properties;if(!(t==="te"?d!=null&&d!=="":u!=null&&u!==""))return;const x=t==="te"?`<div style="font-family:sans-serif;"><strong>${o||"Sin nombre"}</strong><br/>TE: ${d??"N/D"}</div>`:`<div style="font-family:sans-serif;"><strong>${o||"Sin nombre"}</strong><br/>RIEST: ${r??"N/D"}</div>`;new R.Popup().setLngLat(a.lngLat).setHTML(x).addTo(n)}),n.on("mouseenter",s,()=>n.getCanvas().style.cursor="pointer"),n.on("mouseleave",s,()=>n.getCanvas().style.cursor="")}function z(n,s){const t=document.createElement("div");t.innerText=s,t.style.backgroundColor="rgba(255, 255, 255, 0.8)",t.style.padding="5px 10px",t.style.borderRadius="5px",t.style.fontWeight="bold",t.style.fontFamily="sans-serif",t.style.fontSize="14px",t.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)";const e={onAdd:function(){return t},onRemove:function(){t.parentNode.removeChild(t)}};n.addControl(e,"top-left")}function q(n,s,t){const e=document.createElement("div");e.style.backgroundColor="rgba(255,255,255,0.8)",e.style.padding="10px",e.style.borderRadius="5px",e.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",e.style.fontFamily="sans-serif",e.style.fontSize="12px";const a=(o,d)=>{e.innerHTML="";const r=document.createElement("div");if(r.style.fontWeight="bold",r.style.fontSize="14px",r.style.marginBottom="6px",r.style.textAlign="left",r.innerText=s==="te"?"Cuantiles TE":"Razón de Incidencia Estandarizada (RIEST)",e.appendChild(r),s==="te")j.current[d].forEach((f,x)=>{const m=document.createElement("div");m.style.display="flex",m.style.alignItems="center",m.style.marginBottom="2px",m.innerHTML=`<span style="width:20px;height:20px;background:${f.color};display:inline-block;margin-right:5px;"></span>${f.quintil||""}`,e.appendChild(m)});else{const u=Array.from(new Set(o.features.map(x=>x.properties.significativamente_sup_uno))).sort().slice(0,-1).reverse(),f=["Casos por debajo de lo esperado","Casos similar a lo esperado","Casos por encima de lo esperado"];u.forEach((x,m)=>{const S=document.createElement("div");S.style.display="flex",S.style.alignItems="center",S.style.marginBottom="2px",S.innerHTML=`<span style="width:20px;height:20px;background:${x||"transparent"};display:inline-block;margin-right:5px;"></span>${f[m]}`,e.appendChild(S)})}},l={onAdd:function(){const o=E(s,p);return a(o,p),e},onRemove:function(){e.parentNode.removeChild(e)},update:a};return n.addControl(l,"bottom-right"),l}function A(n,s){n.on("move",()=>{b.current||(b.current=!0,s.jumpTo({center:n.getCenter(),zoom:n.getZoom(),bearing:n.getBearing(),pitch:n.getPitch()}),b.current=!1)})}return i.jsxs("div",{style:{display:"grid",gridTemplateRows:"1fr 1fr",gap:"5px",width:"100%",height:"100vh",marginTop:"2%"},children:[i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:n=>v.current[0]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:n=>v.current[1]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]}),i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:n=>v.current[2]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:n=>v.current[3]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]})]})}function N(){const p=[{value:"total_HPE",title:"Cualquier causa"},{value:"Angina_HPE",title:"Angina (no primaria) sin procedimiento"},{value:"Asthma_HPE",title:"Asma en adulto"},{value:"diabetes_HPE",title:"Complicaciones Agudas de la Diabetes"},{value:"Dehydration_HPE",title:"Deshidratación"},{value:"EPOC_HPE",title:"Enfermedad Pulmonar Obstructiva Crónica (EPOC)"},{value:"CHF_HPE",title:"Insuficiencia Cardiaca Congestiva (ICC)"}],h=[{value:"area",title:"Área de Salud"},{value:"zbs",title:"Zona Básica de Salud"}],[v,y]=g.useState(p[0]),[_,C]=g.useState(h[0]);return i.jsxs("div",{style:{gap:"1rem",minHeight:"100vh"},children:[i.jsx("select",{onChange:c=>{const j=p.find(b=>b.value===c.target.value);y(j)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A"},children:p.map(c=>i.jsx("option",{value:c.value,children:c.title},c.value))}),i.jsx("select",{onChange:c=>{const j=h.find(b=>b.value===c.target.value);C(j)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A",marginLeft:"1%"},children:h.map(c=>i.jsx("option",{value:c.value,children:c.title},c.value))}),i.jsx(H,{"client:load":!0,indicator:v.value,map_data:_.value}),i.jsxs("div",{style:{overflowY:"auto"},children:[i.jsxs("p",{children:["Para el conjunto de comunidades autónomas, en el periodo 2021-2023 se calculan la tasa y la razón de incidencia estandarizada. ",i.jsx("br",{}),"No obstante, en algunas comunidades autónomas ",i.jsx("strong",{children:"no se dispone de información actualizada"})," para este periodo:"]}),i.jsxs("ul",{children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Cataluña"}),": sus datos provienen del periodo ",i.jsx("strong",{children:"2018-2020"}),", analizado en el atlas previo."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Galicia y Castilla y León:"})," no se disponen de datos para el periodo ",i.jsx("strong",{children:"2021-2023"}),"."]})]})]})]})}export{N as default};
