import{j as T}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.GzzYzsTh.js";import{m as b,P as D}from"./papaparse.min.BXwBEW0e.js";/* empty css                     */const q="/atlas_hpe/";function F({indicator:y,map_data:m}){const x=d.useRef(null),v=d.useRef(null),C=d.useRef(null),R=d.useRef(null),w=d.useRef(null),E=d.useRef(null),L=d.useRef(!1);async function z(e){const t=await fetch(`${q}data/mapas/mapa_${e}.geojson`);w.current=await t.json();const n=await(await fetch(`${q}data/v_g_a/v_g_a_${e}_2021_2023.csv`)).text();E.current=D.parse(n,{header:!0}).data.filter(r=>Object.keys(r).length>1)}d.useEffect(()=>{if(!x.current||!v.current)return;let e,t;async function i(){await z(m);const n={style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[-5.7038,35.4168],zoom:3.8,attributionControl:!1};e=new b.Map({container:x.current,...n}),t=new b.Map({container:v.current,...n});const r=(o,c)=>{const s=new b.AttributionControl({compact:!0});o.addControl(s,c),o.on("load",()=>{const u=o.getContainer().querySelector(".maplibregl-ctrl-attrib-button"),p=o.getContainer().querySelector(".maplibregl-ctrl-attrib");u&&p&&(p.classList.add("maplibregl-compact"),p.classList.remove("maplibregl-compact-show"))})};r(e,"bottom-left"),r(t,"bottom-left"),C.current=e,R.current=t,e.on("load",()=>{j(e,"multipolygon-left","fill-left","te"),$(e,"fill-left","te",m);const o=M(e,"te");e._legendControl=o}),t.on("load",()=>{j(t,"multipolygon-right","fill-right","riest"),$(t,"fill-right","riest",m);const o=M(t,"riest");t._legendControl=o}),k(e,t),k(t,e)}return i(),()=>{e&&e.remove(),t&&t.remove()}},[m]),d.useEffect(()=>{!w.current||!E.current||(C.current&&_(C.current,"multipolygon-left","te"),R.current&&_(R.current,"multipolygon-right","riest"))},[y]);function _(e,t,i){const n=S(i,y);e.getSource(t)&&e.getSource(t).setData(n),e._legendControl&&e._legendControl.update(n,y)}function S(e,t){const i=structuredClone(w.current),n=E.current.filter(s=>s.indicador===t),r={},o=m==="area"?"idn212":"zbs",c=m==="area"?"IDN":"codatzbs";return n.forEach(s=>r[s[o]]=s),i.features.forEach(s=>{const u=r[s.properties[c]];u&&(s.properties={...s.properties,...u})}),i}function j(e,t,i,n){const r=S(n,y);e.getSource(t)||(e.addSource(t,{type:"geojson",data:r}),e.addLayer({id:i,type:"fill",source:t,paint:{"fill-color":["coalesce",n==="te"?["get","color"]:["get","significativamente_sup_uno"],"transparent"],"fill-opacity":.8}}),e.addLayer({id:`${i}-outline`,type:"line",source:t,paint:{"line-color":"#333","line-width":.5}}))}function $(e,t,i,n){e.on("click",t,r=>{const o=r.features?.[0];if(!o)return;const c=n==="zbs"?o.properties.n_zbs:o.properties.n_area,{te:s,riest:u}=o.properties,p=l=>Math.trunc(l*1e3)/1e3,h=s!=null?p(s):"N/D",f=u!=null?p(u):"N/D",a=i==="te"?`<div style="font-family:sans-serif;"><strong>${c||"Sin nombre"}</strong><br/>TE: ${h}</div>`:`<div style="font-family:sans-serif;"><strong>${c||"Sin nombre"}</strong><br/>RIEST: ${f??"N/D"}</div>`;new b.Popup().setLngLat(r.lngLat).setHTML(a).addTo(e)}),e.on("mouseenter",t,()=>e.getCanvas().style.cursor="pointer"),e.on("mouseleave",t,()=>e.getCanvas().style.cursor="")}function M(e,t,i){const n=document.createElement("div");n.style.backgroundColor="rgba(255,255,255,0.85)",n.style.padding="10px",n.style.borderRadius="5px",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",n.style.fontFamily="sans-serif",n.style.fontSize="12px",n.style.maxWidth="260px";const r=(c,s)=>{n.innerHTML="";const u=document.createElement("div");if(u.style.fontWeight="bold",u.style.marginBottom="6px",u.innerText=t==="te"?"Cuantiles TE":"RazÃ³n de Incidencia Estandarizada (RIEST)",n.appendChild(u),t==="te"){const p=Array.from(new Set(c.features.map(a=>a.properties.color))).filter(Boolean),h=Array.from(new Set(c.features.map(a=>a.properties.quintil))).filter(Boolean),f=p.map((a,l)=>({color:a,quintil:h[l]}));f.sort((a,l)=>{const g=parseInt(a.quintil?.match(/^Q(\d+)/)?.[1]||0,10),B=parseInt(l.quintil?.match(/^Q(\d+)/)?.[1]||0,10);return g-B}),f.forEach(({color:a,quintil:l})=>{const g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.marginBottom="2px",g.innerHTML=`<span style="width:20px;height:20px;background:${a};display:inline-block;margin-right:5px;"></span>${l||""}`,n.appendChild(g)})}else{const p=Array.from(new Set(c.features.map(f=>f.properties.significativamente_sup_uno))).sort().slice(0,-1).reverse(),h=["Casos por debajo de lo esperado","Casos similar a lo esperado","Casos por encima de lo esperado"];p.forEach((f,a)=>{const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.marginBottom="2px",l.innerHTML=`<span style="width:20px;height:20px;background:${f||"transparent"};display:inline-block;margin-right:5px;"></span>${h[a]}`,n.appendChild(l)})}},o={onAdd:function(){const c=S(t,y);return r(c),n},onRemove:function(){n.parentNode.removeChild(n)},update:r};return e.addControl(o,"bottom-right"),o}function k(e,t){e.on("move",()=>{L.current||(L.current=!0,t.jumpTo({center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}),L.current=!1)})}return T.jsxs("div",{style:{display:"flex",width:"100%",height:"65vh",marginTop:"2%"},children:[T.jsx("div",{ref:x,style:{flex:1,height:"100%",borderRight:"1px solid #ccc"}}),T.jsx("div",{ref:v,style:{flex:1,height:"100%"}})]})}export{F as default};
