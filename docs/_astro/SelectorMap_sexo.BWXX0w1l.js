import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.GzzYzsTh.js";import{m as R,P as z}from"./papaparse.min.BXwBEW0e.js";/* empty css                     */const H="/atlas_hpe/";function q({indicator:p,map_data:h}){const v=g.useRef([null,null,null,null]),y=g.useRef([null,null,null,null]),E=g.useRef(null),j=g.useRef(null),d=g.useRef(null),b=g.useRef(!1),C=g.useRef(null);async function M(){const n=await fetch(`${H}data/mapas/mapa_${h}.geojson`);E.current=await n.json();const t=await(await fetch(`${H}data/v_g_s/v_g_s_${h}_hombres_2021_2023.csv`)).text();j.current=z.parse(t,{header:!0}).data.filter(r=>Object.keys(r).length>1);const a=await(await fetch(`${H}data/v_g_s/v_g_s_${h}_mujeres_2021_2023.csv`)).text();d.current=z.parse(a,{header:!0}).data.filter(r=>Object.keys(r).length>1);const l=[...j.current,...d.current],s={};l.forEach(r=>{r.indicador&&r.color&&r.quintil&&(s[r.indicador]||(s[r.indicador]=[]),s[r.indicador].some(f=>f.color===r.color&&f.quintil===r.quintil)||s[r.indicador].push({color:r.color,quintil:r.quintil}))});const c={};Object.keys(s).forEach(r=>{c[r]=[...s[r]].sort((u,f)=>{const x=parseInt(u.quintil.match(/^Q(\d+)/)[1],10),m=parseInt(f.quintil.match(/^Q(\d+)/)[1],10);return x-m})}),C.current=c}g.useEffect(()=>{async function n(){await M();const o={style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[-6.7038,35.4168],zoom:4,attributionControl:!1};for(let t=0;t<4;t++){const e=new R.Map({container:v.current[t],attributionControl:{compact:!0},...o});e.addControl(new R.AttributionControl({compact:!0}),"bottom-left"),y.current[t]=e,e.on("load",()=>{const a=e.getContainer().querySelector(".maplibregl-ctrl-attrib-button"),l=e.getContainer().querySelector(".maplibregl-ctrl-attrib");a&&l&&(l.classList.add("maplibregl-compact"),l.classList.remove("maplibregl-compact-show"));const s=t<2?"te":"riest",c=`multipolygon-${t}`,r=`fill-${t}`;P(e,c,r,s),$(e,r,s,h);let u="";t===0?(u="Población Hombres",T(e,u)):t===1&&(u="Población Mujeres",T(e,u));const f=D(e,s);e._legendControl=f})}for(let t=0;t<4;t++)for(let e=0;e<4;e++)t!==e&&L(y.current[t],y.current[e])}return n(),()=>{y.current.forEach(o=>o?.remove())}},[h]),g.useEffect(()=>{!E.current||!j.current||!d.current||y.current.forEach((n,o)=>{if(!n)return;const t=o<2?"te":"riest",e=`multipolygon-${o}`;let a;o===0||o===2?a=_(t,p,"H"):a=_(t,p,"M"),n.getSource(e)&&n.getSource(e).setData(a),n._legendControl&&n._legendControl.update(a,p)})},[p]);function _(n,o,t){const e=structuredClone(E.current);let a="";t==="H"?a=j.current.filter(s=>s.indicador===o):a=d.current.filter(s=>s.indicador===o);const l={};return h==="area"?(a.forEach(s=>{l[s.idn212]=s}),e.features.forEach(s=>{const c=l[s.properties.IDN];c&&(s.properties={...s.properties,...c})})):(a.forEach(s=>{l[s.zbs]=s}),e.features.forEach(s=>{const c=l[s.properties.codatzbs];c&&(s.properties={...s.properties,...c})})),e}function P(n,o,t,e){let a;t==="fill-0"||t==="fill-2"?a=_(e,p,"H"):a=_(e,p,"M"),n.getSource(o)?n.getSource(o).setData(a):(n.addSource(o,{type:"geojson",data:a}),n.addLayer({id:t,type:"fill",source:o,paint:{"fill-color":["coalesce",e==="te"?["get","color"]:["get","significativamente_sup_uno"],"transparent"],"fill-opacity":.8}}),n.addLayer({id:`${t}-outline`,type:"line",source:o,paint:{"line-color":"#333","line-width":.5}}))}function $(n,o,t,e){n.on("click",o,a=>{const l=a.features?.[0];if(!l)return;const s=e==="zbs"?l.properties.n_zbs:l.properties.n_area,{te:c,riest:r,significativamente_sup_uno:u}=l.properties;if(!(t==="te"?c!=null&&c!=="":u!=null&&u!==""))return;const x=t==="te"?`<div style="font-family:sans-serif;"><strong>${s||"Sin nombre"}</strong><br/>TE: ${c??"N/D"}</div>`:`<div style="font-family:sans-serif;"><strong>${s||"Sin nombre"}</strong><br/>RIEST: ${r??"N/D"}</div>`;new R.Popup().setLngLat(a.lngLat).setHTML(x).addTo(n)}),n.on("mouseenter",o,()=>n.getCanvas().style.cursor="pointer"),n.on("mouseleave",o,()=>n.getCanvas().style.cursor="")}function T(n,o){const t=document.createElement("div");t.innerText=o,t.style.backgroundColor="rgba(255, 255, 255, 0.8)",t.style.padding="5px 10px",t.style.borderRadius="5px",t.style.fontWeight="bold",t.style.fontFamily="sans-serif",t.style.fontSize="14px",t.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)";const e={onAdd:function(){return t},onRemove:function(){t.parentNode.removeChild(t)}};n.addControl(e,"top-left")}function D(n,o,t){const e=document.createElement("div");e.style.backgroundColor="rgba(255,255,255,0.8)",e.style.padding="10px",e.style.borderRadius="5px",e.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",e.style.fontFamily="sans-serif",e.style.fontSize="12px";const a=(s,c)=>{e.innerHTML="";const r=document.createElement("div");if(r.style.fontWeight="bold",r.style.fontSize="14px",r.style.marginBottom="6px",r.style.textAlign="left",r.innerText=o==="te"?"Cuantiles TE":"Razón de Incidencia Estandarizada (RIEST)",e.appendChild(r),o==="te")console.log(C.current),console.log(c),C.current[c].forEach((f,x)=>{const m=document.createElement("div");m.style.display="flex",m.style.alignItems="center",m.style.marginBottom="2px",m.innerHTML=`<span style="width:20px;height:20px;background:${f.color};display:inline-block;margin-right:5px;"></span>${f.quintil||""}`,e.appendChild(m)});else{const u=Array.from(new Set(s.features.map(x=>x.properties.significativamente_sup_uno))).sort().slice(0,-1).reverse(),f=["Casos por debajo de lo esperado","Casos similar a lo esperado","Casos por encima de lo esperado"];u.forEach((x,m)=>{const S=document.createElement("div");S.style.display="flex",S.style.alignItems="center",S.style.marginBottom="2px",S.innerHTML=`<span style="width:20px;height:20px;background:${x||"transparent"};display:inline-block;margin-right:5px;"></span>${f[m]}`,e.appendChild(S)})}},l={onAdd:function(){const s=_(o,p);return a(s,p),e},onRemove:function(){e.parentNode.removeChild(e)},update:a};return n.addControl(l,"bottom-right"),l}function L(n,o){n.on("move",()=>{b.current||(b.current=!0,o.jumpTo({center:n.getCenter(),zoom:n.getZoom(),bearing:n.getBearing(),pitch:n.getPitch()}),b.current=!1)})}return i.jsxs("div",{style:{display:"grid",gridTemplateRows:"1fr 1fr",gap:"5px",width:"100%",height:"100vh",marginTop:"2%"},children:[i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:n=>v.current[0]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:n=>v.current[1]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]}),i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:n=>v.current[2]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:n=>v.current[3]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]})]})}function N(){const p=[{value:"total_HPE",title:"Cualquier causa"},{value:"Angina_HPE",title:"Angina (no primaria) sin procedimiento"},{value:"Asthma_HPE",title:"Asma en adulto"},{value:"diabetes_HPE",title:"Complicaciones Agudas de la Diabetes"},{value:"Dehydration_HPE",title:"Deshidratación"},{value:"EPOC_HPE",title:"Enfermedad Pulmonar Obstructiva Crónica (EPOC)"},{value:"CHF_HPE",title:"Insuficiencia Cardiaca Congestiva (ICC)"}],h=[{value:"area",title:"Área de Salud"},{value:"zbs",title:"Zona Básica de Salud"}],[v,y]=g.useState(p[0]),[E,j]=g.useState(h[0]);return i.jsxs("div",{style:{gap:"1rem",minHeight:"100vh"},children:[i.jsx("select",{onChange:d=>{const b=p.find(C=>C.value===d.target.value);y(b)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A"},children:p.map(d=>i.jsx("option",{value:d.value,children:d.title},d.value))}),i.jsx("select",{onChange:d=>{const b=h.find(C=>C.value===d.target.value);j(b)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A",marginLeft:"1%"},children:h.map(d=>i.jsx("option",{value:d.value,children:d.title},d.value))}),i.jsx(q,{"client:load":!0,indicator:v.value,map_data:E.value}),i.jsxs("div",{style:{overflowY:"auto"},children:[i.jsxs("p",{children:["Para el conjunto de comunidades autónomas, en el periodo 2021-2023 se calculan la tasa y la razón de incidencia estandarizada. ",i.jsx("br",{}),"No obstante, en algunas comunidades autónomas ",i.jsx("strong",{children:"no se dispone de información actualizada"})," para este periodo:"]}),i.jsxs("ul",{children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Cataluña"}),": sus datos provienen del periodo ",i.jsx("strong",{children:"2018-2020"}),", analizado en el atlas previo."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Galicia y Castilla y León:"})," no se disponen de datos para el periodo ",i.jsx("strong",{children:"2021-2023"}),"."]})]})]})]})}export{N as default};
