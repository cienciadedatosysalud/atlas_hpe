import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.GzzYzsTh.js";import{m as S,P as T}from"./papaparse.min.BXwBEW0e.js";/* empty css                     */const z="/atlas_hpe/";function $({indicator:u,map_data:h}){const x=g.useRef([null,null,null,null]),v=g.useRef([null,null,null,null]),_=g.useRef(null),b=g.useRef(null),c=g.useRef(null),C=g.useRef(null),y=g.useRef(!1);async function L(){const t=await fetch(`${z}data/mapas/mapa_${h}.geojson`);_.current=await t.json();const n=await(await fetch(`${z}data/v_g_e/v_g_e_${h}_65_80_2021_2023.csv`)).text();b.current=T.parse(n,{header:!0}).data.filter(r=>Object.keys(r).length>1);const a=await(await fetch(`${z}data/v_g_e/v_g_e_${h}_80_2021_2023.csv`)).text();c.current=T.parse(a,{header:!0}).data.filter(r=>Object.keys(r).length>1);const l=[...b.current,...c.current],o={};l.forEach(r=>{r.indicador&&r.color&&r.quintil&&(o[r.indicador]||(o[r.indicador]=[]),o[r.indicador].some(f=>f.color===r.color&&f.quintil===r.quintil)||o[r.indicador].push({color:r.color,quintil:r.quintil}))});const d={};Object.keys(o).forEach(r=>{d[r]=[...o[r]].sort((p,f)=>{const j=parseInt(p.quintil.match(/^Q(\d+)/)[1],10),m=parseInt(f.quintil.match(/^Q(\d+)/)[1],10);return j-m})}),C.current=d}g.useEffect(()=>{async function t(){await L();const s={style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[-5.7038,35.4168],zoom:3.8,attributionControl:!1};for(let n=0;n<4;n++){const e=new S.Map({container:x.current[n],attributionControl:{compact:!0},...s});e.addControl(new S.AttributionControl({compact:!0}),"bottom-left"),v.current[n]=e,e.on("load",()=>{const a=e.getContainer().querySelector(".maplibregl-ctrl-attrib-button"),l=e.getContainer().querySelector(".maplibregl-ctrl-attrib");a&&l&&(l.classList.add("maplibregl-compact"),l.classList.remove("maplibregl-compact-show"));const o=n<2?"te":"riest",d=`multipolygon-${n}`,r=`fill-${n}`;q(e,d,r,o),A(e,r,o,h);let p="";n===0?(p="Población 65 a 79 años",P(e,p)):n===1&&(p="Población mayores 80 años",P(e,p));const f=D(e,o);e._legendControl=f})}for(let n=0;n<4;n++)for(let e=0;e<4;e++)n!==e&&H(v.current[n],v.current[e])}return t(),()=>{v.current.forEach(s=>s?.remove())}},[h]),g.useEffect(()=>{!_.current||!b.current||!c.current||v.current.forEach((t,s)=>{if(!t)return;const n=s<2?"te":"riest",e=`multipolygon-${s}`;let a;s===0||s===2?a=E(n,u,"65_80"):a=E(n,u,"80"),t.getSource(e)&&t.getSource(e).setData(a),t._legendControl&&t._legendControl.update(a,u)})},[u]);function E(t,s,n){const e=structuredClone(_.current);let a="";n==="65_80"?a=b.current.filter(o=>o.indicador===s):a=c.current.filter(o=>o.indicador===s);const l={};return h==="area"?(a.forEach(o=>{l[o.idn212]=o}),e.features.forEach(o=>{const d=l[o.properties.IDN];d&&(o.properties={...o.properties,...d})})):(a.forEach(o=>{l[o.zbs]=o}),e.features.forEach(o=>{const d=l[o.properties.codatzbs];d&&(o.properties={...o.properties,...d})})),e}function q(t,s,n,e){let a;n==="fill-0"||n==="fill-2"?a=E(e,u,"65_80"):a=E(e,u,"80"),t.getSource(s)?t.getSource(s).setData(a):(t.addSource(s,{type:"geojson",data:a}),t.addLayer({id:n,type:"fill",source:s,paint:{"fill-color":["coalesce",e==="te"?["get","color"]:["get","significativamente_sup_uno"],"transparent"],"fill-opacity":.8}}),t.addLayer({id:`${n}-outline`,type:"line",source:s,paint:{"line-color":"#333","line-width":.5}}))}function A(t,s,n,e){t.on("click",s,a=>{const l=a.features?.[0];if(!l)return;e==="zbs"?l.properties.n_zbs:l.properties.n_area;const{te:o,riest:d,significativamente_sup_uno:r}=l.properties;(n==="te"?o!=null&&o!=="":r!=null&&r!=="")&&new S.Popup().setLngLat(a.lngLat).setHTML(popupContent).addTo(t)}),t.on("mouseenter",s,()=>t.getCanvas().style.cursor="pointer"),t.on("mouseleave",s,()=>t.getCanvas().style.cursor="")}function P(t,s){const n=document.createElement("div");n.innerText=s,n.style.backgroundColor="rgba(255, 255, 255, 0.8)",n.style.padding="5px 10px",n.style.borderRadius="5px",n.style.fontWeight="bold",n.style.fontFamily="sans-serif",n.style.fontSize="14px",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)";const e={onAdd:function(){return n},onRemove:function(){n.parentNode.removeChild(n)}};t.addControl(e,"top-left")}function D(t,s,n){const e=document.createElement("div");e.style.backgroundColor="rgba(255,255,255,0.8)",e.style.padding="10px",e.style.borderRadius="5px",e.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",e.style.fontFamily="sans-serif",e.style.fontSize="12px";const a=(o,d)=>{e.innerHTML="";const r=document.createElement("div");if(r.style.fontWeight="bold",r.style.fontSize="14px",r.style.marginBottom="6px",r.style.textAlign="left",r.innerText=s==="te"?"Cuantiles TE":"Razón de Incidencia Estandarizada (RIEST)",e.appendChild(r),s==="te")C.current[d].forEach((f,j)=>{const m=document.createElement("div");m.style.display="flex",m.style.alignItems="center",m.style.marginBottom="2px",m.innerHTML=`<span style="width:20px;height:20px;background:${f.color};display:inline-block;margin-right:5px;"></span>${f.quintil||""}`,e.appendChild(m)});else{const p=Array.from(new Set(o.features.map(j=>j.properties.significativamente_sup_uno))).sort().slice(0,-1).reverse(),f=["Casos por debajo de lo esperado","Casos similar a lo esperado","Casos por encima de lo esperado"];p.forEach((j,m)=>{const R=document.createElement("div");R.style.display="flex",R.style.alignItems="center",R.style.marginBottom="2px",R.innerHTML=`<span style="width:20px;height:20px;background:${j||"transparent"};display:inline-block;margin-right:5px;"></span>${f[m]}`,e.appendChild(R)})}},l={onAdd:function(){const o=E(s,u);return a(o,u),e},onRemove:function(){e.parentNode.removeChild(e)},update:a};return t.addControl(l,"bottom-right"),l}function H(t,s){t.on("move",()=>{y.current||(y.current=!0,s.jumpTo({center:t.getCenter(),zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch()}),y.current=!1)})}return i.jsxs("div",{style:{display:"grid",gridTemplateRows:"1fr 1fr",gap:"5px",width:"100%",height:"100vh",marginTop:"2%"},children:[i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:t=>x.current[0]=t,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:t=>x.current[1]=t,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]}),i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:t=>x.current[2]=t,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:t=>x.current[3]=t,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]})]})}function O(){const u=[{value:"total_HPE",title:"Cualquier causa"},{value:"Angina_HPE",title:"Angina (no primaria) sin procedimiento"},{value:"Asthma_HPE",title:"Asma en adulto"},{value:"diabetes_HPE",title:"Complicaciones Agudas de la Diabetes"},{value:"Dehydration_HPE",title:"Deshidratación"},{value:"EPOC_HPE",title:"Enfermedad Pulmonar Obstructiva Crónica (EPOC)"},{value:"CHF_HPE",title:"Insuficiencia Cardiaca Congestiva (ICC)"}],h=[{value:"area",title:"Área de Salud"},{value:"zbs",title:"Zona Básica de Salud"}],[x,v]=g.useState(u[0]),[_,b]=g.useState(h[0]);return i.jsxs("div",{style:{gap:"1rem",minHeight:"100vh"},children:[i.jsx("select",{onChange:c=>{const C=u.find(y=>y.value===c.target.value);v(C)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A"},children:u.map(c=>i.jsx("option",{value:c.value,children:c.title},c.value))}),i.jsx("select",{onChange:c=>{const C=h.find(y=>y.value===c.target.value);b(C)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A",marginLeft:"1%"},children:h.map(c=>i.jsx("option",{value:c.value,children:c.title},c.value))}),i.jsx($,{"client:load":!0,indicator:x.value,map_data:_.value}),i.jsxs("div",{style:{overflowY:"auto"},children:[i.jsxs("p",{children:["Para el conjunto de comunidades autónomas, en el periodo 2021-2023 se calculan la tasa y la razón de incidencia estandarizada. ",i.jsx("br",{}),"No obstante, en algunas comunidades autónomas ",i.jsx("strong",{children:"no se dispone de información actualizada"})," para este periodo:"]}),i.jsxs("ul",{children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Cataluña"}),": sus datos provienen del periodo ",i.jsx("strong",{children:"2018-2020"}),", analizado en el atlas previo."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Galicia y Castilla y León:"})," no se disponen de datos para el periodo ",i.jsx("strong",{children:"2021-2023"}),"."]})]})]})]})}export{O as default};
