import{j as _}from"./jsx-runtime.D_zvdyIk.js";import{r as p}from"./index.GzzYzsTh.js";import{m as b,P as D}from"./papaparse.min.BXwBEW0e.js";/* empty css                     */const z="/atlas_hpe/";function F({indicator:y,map_data:g}){const v=p.useRef(null),x=p.useRef(null),C=p.useRef(null),R=p.useRef(null),w=p.useRef(null),E=p.useRef(null),L=p.useRef(!1);async function B(e){const t=await fetch(`${z}data/mapas/mapa_${e}.geojson`);w.current=await t.json();const n=await(await fetch(`${z}data/v_g_a/v_g_a_${e}_2021_2023.csv`)).text();E.current=D.parse(n,{header:!0}).data.filter(r=>Object.keys(r).length>1)}p.useEffect(()=>{if(!v.current||!x.current)return;let e,t;async function s(){await B(g);const n={style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[-6.7038,35.4168],zoom:4,attributionControl:!1};e=new b.Map({container:v.current,...n}),t=new b.Map({container:x.current,...n});const r=(o,a)=>{const i=new b.AttributionControl({compact:!0});o.addControl(i,a),o.on("load",()=>{const l=o.getContainer().querySelector(".maplibregl-ctrl-attrib-button"),d=o.getContainer().querySelector(".maplibregl-ctrl-attrib");l&&d&&(d.classList.add("maplibregl-compact"),d.classList.remove("maplibregl-compact-show"))})};r(e,"bottom-left"),r(t,"bottom-left"),C.current=e,R.current=t,e.on("load",()=>{j(e,"multipolygon-left","fill-left","te"),$(e,"fill-left","te",g);const o=k(e,"te");e._legendControl=o}),t.on("load",()=>{j(t,"multipolygon-right","fill-right","riest"),$(t,"fill-right","riest",g);const o=k(t,"riest");t._legendControl=o}),q(e,t),q(t,e)}return s(),()=>{e&&e.remove(),t&&t.remove()}},[g]),p.useEffect(()=>{!w.current||!E.current||(C.current&&T(C.current,"multipolygon-left","te"),R.current&&T(R.current,"multipolygon-right","riest"))},[y]);function T(e,t,s){const n=S(s,y);e.getSource(t)&&e.getSource(t).setData(n),e._legendControl&&e._legendControl.update(n,y)}function S(e,t){const s=structuredClone(w.current),n=E.current.filter(i=>i.indicador===t),r={},o=g==="area"?"idn212":"zbs",a=g==="area"?"IDN":"codatzbs";return n.forEach(i=>r[i[o]]=i),s.features.forEach(i=>{const l=r[i.properties[a]];l&&(i.properties={...i.properties,...l})}),s}function j(e,t,s,n){const r=S(n,y);e.getSource(t)||(e.addSource(t,{type:"geojson",data:r}),e.addLayer({id:s,type:"fill",source:t,paint:{"fill-color":["coalesce",n==="te"?["get","color"]:["get","significativamente_sup_uno"],"transparent"],"fill-opacity":.8}}),e.addLayer({id:`${s}-outline`,type:"line",source:t,paint:{"line-color":"#333","line-width":.5}}))}function $(e,t,s,n){e.on("click",t,r=>{const o=r.features?.[0];if(!o)return;const a=n==="zbs"?o.properties.n_zbs:o.properties.n_area,{te:i,riest:l,significativamente_sup_uno:d}=o.properties,h=s==="te"?`<div style="font-family:sans-serif;"><strong>${a||"Sin nombre"}</strong><br/>TE: ${i??"N/D"}</div>`:`<div style="font-family:sans-serif;"><strong>${a||"Sin nombre"}</strong><br/>RIEST: ${l??"N/D"}</div>`;new b.Popup().setLngLat(r.lngLat).setHTML(h).addTo(e)}),e.on("mouseenter",t,()=>e.getCanvas().style.cursor="pointer"),e.on("mouseleave",t,()=>e.getCanvas().style.cursor="")}function k(e,t,s){const n=document.createElement("div");n.style.backgroundColor="rgba(255,255,255,0.85)",n.style.padding="10px",n.style.borderRadius="5px",n.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",n.style.fontFamily="sans-serif",n.style.fontSize="12px",n.style.maxWidth="260px";const r=(a,i)=>{n.innerHTML="";const l=document.createElement("div");if(l.style.fontWeight="bold",l.style.marginBottom="6px",l.innerText=t==="te"?"Cuantiles TE":"RazÃ³n de Incidencia Estandarizada (RIEST)",n.appendChild(l),t==="te"){const d=Array.from(new Set(a.features.map(c=>c.properties.color))).filter(Boolean),h=Array.from(new Set(a.features.map(c=>c.properties.quintil))).filter(Boolean),m=d.map((c,u)=>({color:c,quintil:h[u]}));m.sort((c,u)=>{const f=parseInt(c.quintil?.match(/^Q(\d+)/)?.[1]||0,10),M=parseInt(u.quintil?.match(/^Q(\d+)/)?.[1]||0,10);return f-M}),m.forEach(({color:c,quintil:u})=>{const f=document.createElement("div");f.style.display="flex",f.style.alignItems="center",f.style.marginBottom="2px",f.innerHTML=`<span style="width:20px;height:20px;background:${c};display:inline-block;margin-right:5px;"></span>${u||""}`,n.appendChild(f)})}else{const d=Array.from(new Set(a.features.map(m=>m.properties.significativamente_sup_uno))).sort().slice(0,-1).reverse(),h=["Casos por debajo de lo esperado","Casos similar a lo esperado","Casos por encima de lo esperado"];d.forEach((m,c)=>{const u=document.createElement("div");u.style.display="flex",u.style.alignItems="center",u.style.marginBottom="2px",u.innerHTML=`<span style="width:20px;height:20px;background:${m||"transparent"};display:inline-block;margin-right:5px;"></span>${h[c]}`,n.appendChild(u)})}},o={onAdd:function(){const a=S(t,y);return r(a),n},onRemove:function(){n.parentNode.removeChild(n)},update:r};return e.addControl(o,"bottom-right"),o}function q(e,t){e.on("move",()=>{L.current||(L.current=!0,t.jumpTo({center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()}),L.current=!1)})}return _.jsxs("div",{style:{display:"flex",width:"100%",height:"65vh",marginTop:"2%"},children:[_.jsx("div",{ref:v,style:{flex:1,height:"100%",borderRight:"1px solid #ccc"}}),_.jsx("div",{ref:x,style:{flex:1,height:"100%"}})]})}export{F as default};
