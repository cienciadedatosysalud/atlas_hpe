import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.GzzYzsTh.js";import{m as R,P as M}from"./papaparse.min.BXwBEW0e.js";/* empty css                     */const T="/atlas_hpe/";function k({indicator:p,map_data:m}){const v=h.useRef([null,null,null,null]),y=h.useRef([null,null,null,null]),_=h.useRef(null),j=h.useRef(null),d=h.useRef(null),b=h.useRef(!1),E=h.useRef(null);async function z(){const n=await fetch(`${T}data/mapas/mapa_${m}.geojson`);_.current=await n.json();const t=await(await fetch(`${T}data/v_g_s/v_g_s_${m}_hombres_2021_2023.csv`)).text();j.current=M.parse(t,{header:!0}).data.filter(s=>Object.keys(s).length>1);const a=await(await fetch(`${T}data/v_g_s/v_g_s_${m}_mujeres_2021_2023.csv`)).text();d.current=M.parse(a,{header:!0}).data.filter(s=>Object.keys(s).length>1);const l=[...j.current,...d.current],r={};l.forEach(s=>{s.indicador&&s.color&&s.quintil&&(r[s.indicador]||(r[s.indicador]=[]),r[s.indicador].some(f=>f.color===s.color&&f.quintil===s.quintil)||r[s.indicador].push({color:s.color,quintil:s.quintil}))});const c={};Object.keys(r).forEach(s=>{c[s]=[...r[s]].sort((u,f)=>{const x=parseInt(u.quintil.match(/^Q(\d+)/)[1],10),g=parseInt(f.quintil.match(/^Q(\d+)/)[1],10);return x-g})}),E.current=c}h.useEffect(()=>{async function n(){await z();const o={style:"https://basemaps.cartocdn.com/gl/positron-nolabels-gl-style/style.json",center:[-5.7038,35.4168],zoom:3.8,attributionControl:!1};for(let t=0;t<4;t++){const e=new R.Map({container:v.current[t],attributionControl:{compact:!0},...o});e.addControl(new R.AttributionControl({compact:!0}),"bottom-left"),y.current[t]=e,e.on("load",()=>{const a=e.getContainer().querySelector(".maplibregl-ctrl-attrib-button"),l=e.getContainer().querySelector(".maplibregl-ctrl-attrib");a&&l&&(l.classList.add("maplibregl-compact"),l.classList.remove("maplibregl-compact-show"));const r=t<2?"te":"riest",c=`multipolygon-${t}`,s=`fill-${t}`;D(e,c,s,r),P(e,s,r,m);let u="";t===0?(u="Población Hombres",H(e,u)):t===1&&(u="Población Mujeres",H(e,u));const f=$(e,r);e._legendControl=f})}for(let t=0;t<4;t++)for(let e=0;e<4;e++)t!==e&&L(y.current[t],y.current[e])}return n(),()=>{y.current.forEach(o=>o?.remove())}},[m]),h.useEffect(()=>{!_.current||!j.current||!d.current||y.current.forEach((n,o)=>{if(!n)return;const t=o<2?"te":"riest",e=`multipolygon-${o}`;let a;o===0||o===2?a=S(t,p,"H"):a=S(t,p,"M"),n.getSource(e)&&n.getSource(e).setData(a),n._legendControl&&n._legendControl.update(a,p)})},[p]);function S(n,o,t){const e=structuredClone(_.current);let a="";t==="H"?a=j.current.filter(r=>r.indicador===o):a=d.current.filter(r=>r.indicador===o);const l={};return m==="area"?(a.forEach(r=>{l[r.idn212]=r}),e.features.forEach(r=>{const c=l[r.properties.IDN];c&&(r.properties={...r.properties,...c})})):(a.forEach(r=>{l[r.zbs]=r}),e.features.forEach(r=>{const c=l[r.properties.codatzbs];c&&(r.properties={...r.properties,...c})})),e}function D(n,o,t,e){let a;t==="fill-0"||t==="fill-2"?a=S(e,p,"H"):a=S(e,p,"M"),n.getSource(o)?n.getSource(o).setData(a):(n.addSource(o,{type:"geojson",data:a}),n.addLayer({id:t,type:"fill",source:o,paint:{"fill-color":["coalesce",e==="te"?["get","color"]:["get","significativamente_sup_uno"],"transparent"],"fill-opacity":.8}}),n.addLayer({id:`${t}-outline`,type:"line",source:o,paint:{"line-color":"#333","line-width":.5}}))}function P(n,o,t,e){n.on("click",o,a=>{const l=a.features?.[0];if(!l)return;const r=e==="zbs"?l.properties.n_zbs:l.properties.n_area,{te:c,riest:s,significativamente_sup_uno:u}=l.properties;if(!(t==="te"?c!=null&&c!=="":u!=null&&u!==""))return;const x=A=>Math.trunc(A*1e3)/1e3,g=c!=null?x(c):"N/D",C=s!=null?x(s):"N/D",q=t==="te"?`<div style="font-family:sans-serif;"><strong>${r||"Sin nombre"}</strong><br/>TE: ${g}</div>`:`<div style="font-family:sans-serif;"><strong>${r||"Sin nombre"}</strong><br/>RIEST: ${C??"N/D"}</div>`;new R.Popup().setLngLat(a.lngLat).setHTML(q).addTo(n)}),n.on("mouseenter",o,()=>n.getCanvas().style.cursor="pointer"),n.on("mouseleave",o,()=>n.getCanvas().style.cursor="")}function H(n,o){const t=document.createElement("div");t.innerText=o,t.style.backgroundColor="rgba(255, 255, 255, 0.8)",t.style.padding="5px 10px",t.style.borderRadius="5px",t.style.fontWeight="bold",t.style.fontFamily="sans-serif",t.style.fontSize="14px",t.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)";const e={onAdd:function(){return t},onRemove:function(){t.parentNode.removeChild(t)}};n.addControl(e,"top-left")}function $(n,o,t){const e=document.createElement("div");e.style.backgroundColor="rgba(255,255,255,0.8)",e.style.padding="10px",e.style.borderRadius="5px",e.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",e.style.fontFamily="sans-serif",e.style.fontSize="12px";const a=(r,c)=>{e.innerHTML="";const s=document.createElement("div");if(s.style.fontWeight="bold",s.style.fontSize="14px",s.style.marginBottom="6px",s.style.textAlign="left",s.innerText=o==="te"?"Cuantiles TE":"Razón de Incidencia Estandarizada (RIEST)",e.appendChild(s),o==="te")E.current[c].forEach((f,x)=>{const g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.marginBottom="2px",g.innerHTML=`<span style="width:20px;height:20px;background:${f.color};display:inline-block;margin-right:5px;"></span>${f.quintil||""}`,e.appendChild(g)});else{const u=Array.from(new Set(r.features.map(x=>x.properties.significativamente_sup_uno))).sort().slice(0,-1).reverse(),f=["Casos por debajo de lo esperado","Casos similar a lo esperado","Casos por encima de lo esperado"];u.forEach((x,g)=>{const C=document.createElement("div");C.style.display="flex",C.style.alignItems="center",C.style.marginBottom="2px",C.innerHTML=`<span style="width:20px;height:20px;background:${x||"transparent"};display:inline-block;margin-right:5px;"></span>${f[g]}`,e.appendChild(C)})}},l={onAdd:function(){const r=S(o,p);return a(r,p),e},onRemove:function(){e.parentNode.removeChild(e)},update:a};return n.addControl(l,"bottom-right"),l}function L(n,o){n.on("move",()=>{b.current||(b.current=!0,o.jumpTo({center:n.getCenter(),zoom:n.getZoom(),bearing:n.getBearing(),pitch:n.getPitch()}),b.current=!1)})}return i.jsxs("div",{style:{display:"grid",gridTemplateRows:"1fr 1fr",gap:"5px",width:"100%",height:"100vh",marginTop:"2%"},children:[i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:n=>v.current[0]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:n=>v.current[1]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]}),i.jsxs("div",{style:{display:"flex",gap:"5px"},children:[i.jsx("div",{ref:n=>v.current[2]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}}),i.jsx("div",{ref:n=>v.current[3]=n,style:{flex:1,height:"100%",border:"1px solid #ccc"}})]})]})}function I(){const p=[{value:"total_HPE",title:"Cualquier causa"},{value:"Angina_HPE",title:"Angina (no primaria) sin procedimiento"},{value:"Asthma_HPE",title:"Asma en adulto"},{value:"diabetes_HPE",title:"Complicaciones Agudas de la Diabetes"},{value:"Dehydration_HPE",title:"Deshidratación"},{value:"EPOC_HPE",title:"Enfermedad Pulmonar Obstructiva Crónica (EPOC)"},{value:"CHF_HPE",title:"Insuficiencia Cardiaca Congestiva (ICC)"}],m=[{value:"area",title:"Área de Salud"},{value:"zbs",title:"Zona Básica de Salud"}],[v,y]=h.useState(p[0]),[_,j]=h.useState(m[0]);return i.jsxs("div",{style:{gap:"1rem",minHeight:"100vh"},children:[i.jsx("select",{onChange:d=>{const b=p.find(E=>E.value===d.target.value);y(b)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A"},children:p.map(d=>i.jsx("option",{value:d.value,children:d.title},d.value))}),i.jsx("select",{onChange:d=>{const b=m.find(E=>E.value===d.target.value);j(b)},style:{fontSize:"1rem",fontWeight:"bold",padding:"0.5rem 1rem",lineHeight:"1.2",borderRadius:"8px",width:"30%",backgroundColor:"#ECD87A",marginLeft:"1%"},children:m.map(d=>i.jsx("option",{value:d.value,children:d.title},d.value))}),i.jsx(k,{"client:load":!0,indicator:v.value,map_data:_.value}),i.jsxs("div",{style:{overflowY:"auto"},children:[i.jsxs("p",{children:["Para el conjunto de comunidades autónomas, en el periodo 2021-2023 se calculan la tasa y la razón de incidencia estandarizada. ",i.jsx("br",{}),"No obstante, en algunas comunidades autónomas ",i.jsx("strong",{children:"no se dispone de información actualizada"})," para este periodo:"]}),i.jsxs("ul",{children:[i.jsxs("li",{children:[i.jsx("strong",{children:"Cataluña"}),": sus datos provienen del periodo ",i.jsx("strong",{children:"2018-2020"}),", analizado en el atlas previo."]}),i.jsxs("li",{children:[i.jsx("strong",{children:"Galicia y Castilla y León:"})," no se disponen de datos para el periodo ",i.jsx("strong",{children:"2021-2023"}),"."]})]})]})]})}export{I as default};
